<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Products | Aarohi Electrical</title>

<style>
body { margin:0; font-family:system-ui; background:#f1f3f6; }
header {
  background:#2874f0; color:#fff;
  padding:14px 20px;
  display:flex; align-items:center; gap:12px;
}
header img {
  width:40px; height:40px; border-radius:50%;
  object-fit:cover; background:#fff; padding:3px;
}
.container { padding:20px; max-width:1200px; margin:auto; }
.grid {
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
  gap:16px;
}
.card {
  background:#fff;
  border-radius:8px;
  padding:12px;
  box-shadow:0 2px 6px rgba(0,0,0,.1);
  cursor:pointer;
  position:relative;
}
.card img {
  width:100%; height:160px;
  object-fit:contain;
}
.badge {
  position:absolute;
  top:10px; left:10px;
  background:#ff3d00; color:#fff;
  padding:4px 8px; font-size:12px;
  border-radius:4px;
}
.name { font-weight:600; margin:8px 0 4px; }
.mrp { color:#888; text-decoration:line-through; font-size:14px; }
.price { font-size:18px; font-weight:700; }
.back { display:inline-block; margin-bottom:15px; color:#2874f0; text-decoration:none; }
</style>
</head>

<body>

<header>
  <img src="logo.jpg">
  <strong>Aarohi Electrical & Electronics</strong>
</header>

<div class="container">
  <a class="back" href="index.html">← Back to Categories</a>
  <h2 id="title">Products</h2>
  <div id="grid" class="grid">Loading…</div>
</div>

<script>
/* ========== CONFIG ========== */
const DATA_URL = "https://script.google.com/macros/s/AKfycbyJQF3Jy481wx3yJgC4hckNuaz9_NIKwVqladLzoZrUrs9sF6-sQmOo_M-L2uv-n9HHRA/exec";
const CACHE_KEY = "AEE_PRODUCTS_CACHE";
const CACHE_TIME = 5 * 60 * 1000;
/* ============================ */

const params = new URLSearchParams(location.search);
const category = decodeURIComponent(params.get("cat")||"").trim().toLowerCase();

async function getProducts() {
  const cached = localStorage.getItem(CACHE_KEY);
  const cachedTime = localStorage.getItem(CACHE_KEY+"_TIME");

  if (cached && cachedTime && Date.now()-cachedTime < CACHE_TIME) {
    return JSON.parse(cached);
  }

  const res = await fetch(DATA_URL);
  const data = await res.json();
  localStorage.setItem(CACHE_KEY, JSON.stringify(data));
  localStorage.setItem(CACHE_KEY+"_TIME", Date.now());
  return data;
}

getProducts().then(data => {
  const products = data.filter(p =>
    String(p.active).toLowerCase().trim() === "yes" &&
    p.category && p.category.toLowerCase().trim() === category
  );

  document.getElementById("title").innerText =
    category.charAt(0).toUpperCase()+category.slice(1);

  document.getElementById("grid").innerHTML =
    products.map(p => {
      const img = p.images ? p.images.split(",")[0] : "";
      return `
        <div class="card" onclick="openProduct('${p.id}')">
          ${p.offer ? `<div class="badge">${p.offer}</div>` : ""}
          <img src="${img}" loading="lazy">
          <div class="name">${p.brand} ${p.model}</div>
          ${p.mrp ? `<div class="mrp">₹${p.mrp}</div>` : ""}
          <div class="price">₹${p.price}</div>
        </div>
      `;
    }).join("");
});

function openProduct(id) {
  if (!id || isNaN(id)) {
    console.error("Invalid product id:", id);
    return;
  }
  window.location.href = `product.html?id=${id}`;
}

</script>

</body>
</html>
